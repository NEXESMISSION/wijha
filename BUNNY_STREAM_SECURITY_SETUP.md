# ๐ ุฅุนุฏุงุฏ ุฃูุงู Bunny Stream

ุฏููู ุดุงูู ูุชูุนูู ุฌููุน ููุฒุงุช ุงูุฃูุงู ูู Bunny Stream ูุญูุงูุฉ ูุญุชูู ุงูููุฏูู.

---

## ๐ ุงูุฎุทูุงุช ุงููุทููุจุฉ

### ุงูุฎุทูุฉ 1: ุชุณุฌูู ุงูุฏุฎูู ุฅูู Bunny Dashboard

1. ุงุฐูุจ ุฅูู [Bunny Dashboard](https://dash.bunny.net/)
2. ุณุฌู ุงูุฏุฎูู ุจุญุณุงุจู
3. ุงุฎุชุฑ **Stream** ูู ุงููุงุฆูุฉ ุงูุฌุงูุจูุฉ
4. ุงุฎุชุฑ ููุชุจุฉ ุงูููุฏูู ุงูุฎุงุตุฉ ุจู (Library)

---

### ุงูุฎุทูุฉ 2: ุชูุนูู Token Authentication

#### 2.1 CDN Token Authentication

1. ุงุฐูุจ ุฅูู **Security** ูู ูุงุฆูุฉ ุงูููุชุจุฉ
2. ุงุจุญุซ ุนู **CDN Token Authentication**
3. ูุนูู ุงูุฎูุงุฑ **Enable CDN Token Authentication**
4. ุงูุณุฎ **Token Authentication Key** ูุงุญูุธู ูู ููุงู ุขูู

```bash
# ุฃุถู ุงูููุชุงุญ ูุณุฑ ูู Supabase Edge Functions
npx supabase secrets set BUNNY_STREAM_TOKEN_KEY="your-token-key-here"
```

#### 2.2 Embed Token Authentication (ุงุฎุชูุงุฑู ููู ููุตู ุจู)

1. ูู ููุณ ุตูุญุฉ Security
2. ูุนูู **Embed view token authentication**
3. ูุฐุง ูุชุทูุจ ุชูููุฏ ุฑููุฒ ููุนุฑุถ ูู iframe

---

### ุงูุฎุทูุฉ 3: ุชูููุฏ ุงููุทุงูุงุช (Domain Restriction)

#### 3.1 Allowed Domains

1. ูู ุตูุญุฉ **Security**
2. ุงุจุญุซ ุนู **Allowed domains**
3. ุฃุถู ุงููุทุงูุงุช ุงููุณููุญ ููุง ุจุชุดุบูู ุงูููุฏูู:

```
yourdomain.com
*.yourdomain.com
localhost
127.0.0.1
```

**ููุงุญุธุฉ:** ุฃุซูุงุก ุงูุชุทููุฑุ ุฃุถู `localhost` ู `127.0.0.1`

#### 3.2 Blocked Domains

1. ููููู ุฅุถุงูุฉ ูุทุงูุงุช ูุญุธูุฑุฉ
2. ุฃู ูุทุงู ูุฏุฑุฌ ููุง ูู ูุชููู ูู ุชุดุบูู ุงูููุฏูู

---

### ุงูุฎุทูุฉ 4: ุชุนุทูู Direct Play (ููุตู ุจู ููุฃูุงู ุงูุนุงูู)

1. ูู ุตูุญุฉ **Security**
2. ุฃููู **Enable direct play**
3. ูุฐุง ูุฌุจุฑ ุงุณุชุฎุฏุงู Embed Player ููุท

**ููุงุญุธุฉ:** ุฅุฐุง ุฃูููุช Direct Playุ ุงุณุชุฎุฏู Bunny Player ุงููุฏูุฌ ุจุฏูุงู ูู ุฑูุงุจุท ุงูููุฏูู ุงููุจุงุดุฑุฉ.

---

### ุงูุฎุทูุฉ 5: ุฅุนุฏุงุฏ Supabase Edge Functions

#### 5.1 ุฅุถุงูุฉ ุงูุฃุณุฑุงุฑ

```bash
# ุงุฐูุจ ุฅูู ูุฌูุฏ ุงููุดุฑูุน
cd "C:\Users\Med Saief Allah\Desktop\wijha 3"

# ุชุณุฌูู ุงูุฏุฎูู ุฅูู Supabase
npx supabase login

# ุฑุจุท ุงููุดุฑูุน
npx supabase link --project-ref YOUR_PROJECT_REF

# ุฅุถุงูุฉ ุฃุณุฑุงุฑ Bunny Stream
npx supabase secrets set BUNNY_STREAM_LIBRARY_ID="580416"
npx supabase secrets set BUNNY_STREAM_API_KEY="3b79adac-d88a-4f32-a857f28daa51-ec86-4ace"
npx supabase secrets set BUNNY_STREAM_HOSTNAME="vz-7db112bf-402.b-cdn.net"
npx supabase secrets set BUNNY_STREAM_TOKEN_KEY="YOUR_TOKEN_AUTH_KEY_FROM_BUNNY"
```

#### 5.2 ูุดุฑ Edge Functions

```bash
# ูุดุฑ ุฏุงูุฉ ุชูููุฏ ุฑูุงุจุท ุงูููุฏูู
npx supabase functions deploy generate-video-url

# ูุดุฑ ุฏุงูุฉ ุฑูุน ุงูููุฏูู
npx supabase functions deploy upload-video
```

---

### ุงูุฎุทูุฉ 6: ุชุดุบูู ุณูุฑูุจุช ุฃูุงู ุงูููุฏูู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช

1. ุงุฐูุจ ุฅูู [Supabase Dashboard](https://supabase.com/dashboard)
2. ุงุฎุชุฑ ูุดุฑูุนู
3. ุงุฐูุจ ุฅูู **SQL Editor**
4. ุงูุณุฎ ูุญุชูู ููู `database/ADD_VIDEO_SECURITY.sql`
5. ุงุถุบุท **Run** ูุชูููุฐ ุงูุณูุฑูุจุช

---

## ๐ ููุฒุงุช ุงูุฃูุงู ุงููุทุจูุฉ

### 1. ุฑูุงุจุท ูููุนุฉ (Signed URLs)
- ุงุณุชุฎุฏุงู HMAC-SHA256 ูุชูููุน ุงูุฑูุงุจุท
- ุงูุชูุงุก ุตูุงุญูุฉ ุงูุฑูุงุจุท ุจุนุฏ 4 ุณุงุนุงุช
- ุฑุจุท ุงูุฑุงุจุท ุจูุนุฑู ุงููุณุชุฎุฏู

### 2. ุนูุงูุฉ ูุงุฆูุฉ (Watermark)
- ุนูุงูุฉ ูุงุฆูุฉ ุฏููุงููููุฉ ูุชุญุฑูุฉ
- ุชุญุชูู ุนูู ูุนุฑู ุงููุณุชุฎุฏู ูุงูุฌูุงุฒ
- ูุตุนุจ ุฅุฒุงูุชูุง ุฃู ุชุบุทูุชูุง

### 3. ููุน ุชุณุฌูู ุงูุดุงุดุฉ
- ุงูุชุดุงู Picture-in-Picture
- ุงูุชุดุงู ุฅุฎูุงุก ุนูุงูุฉ ุงูุชุจููุจ
- ููุน ุงูููุฑ ุจุฒุฑ ุงููุฃุฑุฉ ุงูุฃููู
- ููุน ุงุฎุชุตุงุฑุงุช ููุทุงุช ุงูุดุงุดุฉ

### 4. ุชุณุฌูู ุงูุฃุญุฏุงุซ
- ุชุณุฌูู ูู ุนูููุงุช ุงููุดุงูุฏุฉ
- ุชุณุฌูู ูุญุงููุงุช ุงูุชุญููู
- ุชุณุฌูู ุงูุฃูุดุทุฉ ุงููุดุจููุฉ
- ุชูุจููุงุช ูููุดุงุท ุบูุฑ ุงูุนุงุฏู

### 5. ุงูุชุญูู ูู ุงูุฃุฌูุฒุฉ
- ุจุตูุฉ ุงูุฌูุงุฒ (Device Fingerprinting)
- ุฌูุงุฒ ูุงุญุฏ ููู ูุณุชุฎุฏู
- ุฅุจุทุงู ุงูุฌูุณุงุช ุนูุฏ ุชุบููุฑ ุงูุฌูุงุฒ

### 6. ุงูุชุญูู ูู ุงูุชุณุฌูู
- ุงูุชุญูู ูู ุชุณุฌูู ุงูุทุงูุจ ูุจู ุงููุดุงูุฏุฉ
- ุงูุชุญูู ูู ุญุงูุฉ ุงูุชุณุฌูู (ูุนุชูุฏ)
- ููุน ุงููุตูู ุบูุฑ ุงููุตุฑุญ

---

## ๐ ูุฑุงูุจุฉ ุงูุฃูุงู

### ุนุฑุถ ุณุฌูุงุช ุงูููุฏูู

```sql
-- ุนุฑุถ ุขุฎุฑ 100 ุญุฏุซ ููุฏูู
SELECT 
  ve.created_at,
  p.full_name as student_name,
  l.title as lesson_title,
  ve.event_type,
  ve.device_id,
  ve.event_data
FROM video_events ve
JOIN profiles p ON ve.student_id = p.id
JOIN lessons l ON ve.lesson_id = l.id
ORDER BY ve.created_at DESC
LIMIT 100;
```

### ุนุฑุถ ุงูุชูุจููุงุช ุงูุฃูููุฉ

```sql
-- ุนุฑุถ ุงูุชูุจููุงุช ุงูุฃูููุฉ ุบูุฑ ุงููุญูููุฉ
SELECT * FROM security_alerts
WHERE is_resolved = FALSE
ORDER BY severity DESC, created_at DESC;
```

### ููุฎุต ูููู

```sql
-- ููุฎุต ุฃุญุฏุงุซ ุงูููุฏูู ุงููููู
SELECT * FROM video_security_summary
ORDER BY date DESC
LIMIT 30;
```

---

## โ ูุงุฆูุฉ ุงูุชุญูู

- [ ] ุชูุนูู CDN Token Authentication
- [ ] ูุณุฎ Token Authentication Key
- [ ] ุฅุถุงูุฉ ุงูููุชุงุญ ูู Supabase secrets
- [ ] ุชูููุฏ ุงููุทุงูุงุช ุงููุณููุญุฉ
- [ ] ูุดุฑ Edge Functions
- [ ] ุชุดุบูู ุณูุฑูุจุช ูุงุนุฏุฉ ุงูุจูุงูุงุช
- [ ] ุงุฎุชุจุงุฑ ุชุดุบูู ุงูููุฏูู
- [ ] ุงูุชุญูู ูู ุธููุฑ ุงูุนูุงูุฉ ุงููุงุฆูุฉ
- [ ] ุงูุชุญูู ูู ุชุณุฌูู ุงูุฃุญุฏุงุซ

---

## ๐งช ุงุฎุชุจุงุฑ ุงูุฃูุงู

### ุงุฎุชุจุงุฑ 1: ุฑูุงุจุท ูููุนุฉ
1. ุญุงูู ูุชุญ ุฑุงุจุท ููุฏูู ูุจุงุดุฑ ุจุฏูู ุชููู
2. ูุฌุจ ุฃู ููุดู ุงูุชุญููู

### ุงุฎุชุจุงุฑ 2: ุงูุชูุงุก ุงูุตูุงุญูุฉ
1. ุงุญุตู ุนูู ุฑุงุจุท ููุฏูู ูููุน
2. ุงูุชุธุฑ ุญุชู ุงูุชูุงุก ุงูุตูุงุญูุฉ (ุฃู ุบููุฑ ุงูููุช ุนูู ุฌูุงุฒู)
3. ูุฌุจ ุฃู ููุดู ุงูุชุดุบูู

### ุงุฎุชุจุงุฑ 3: ุชูููุฏ ุงููุทุงู
1. ุญุงูู ุชุดุบูู ุงูููุฏูู ูู ูุทุงู ุบูุฑ ูุณููุญ
2. ูุฌุจ ุฃู ููุดู ุงูุชุดุบูู

### ุงุฎุชุจุงุฑ 4: ุงูุนูุงูุฉ ุงููุงุฆูุฉ
1. ุดุบูู ุงูููุฏูู
2. ุชุฃูุฏ ูู ุธููุฑ ุงูุนูุงูุฉ ุงููุงุฆูุฉ
3. ุชุฃูุฏ ูู ุฃููุง ุชุชุญุฑู

### ุงุฎุชุจุงุฑ 5: ุชุณุฌูู ุงูุฃุญุฏุงุซ
1. ุดุงูุฏ ููุฏูู
2. ุชุญูู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
3. ูุฌุจ ุฃู ุชุธูุฑ ุฃุญุฏุงุซ VIDEO_VIEW ู VIDEO_PLAY

---

## ๐จ ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

### ุงูููุฏูู ูุง ูุนูู
1. ุชุญูู ูู ุฃู CDN Token Authentication ููุนูู
2. ุชุญูู ูู ุฃู BUNNY_STREAM_TOKEN_KEY ุตุญูุญ
3. ุชุญูู ูู ุฃู ุงููุทุงู ูุณููุญ

### ุงูุนูุงูุฉ ุงููุงุฆูุฉ ูุง ุชุธูุฑ
1. ุชุญูู ูู ุฃู BunnyPlayer ูุณุชุฎุฏู ุจุดูู ุตุญูุญ
2. ุชุญูู ูู ุฃู watermarkCode ููุฑุฑ ูููููู

### ุงูุฃุญุฏุงุซ ูุง ุชุณุฌู
1. ุชุญูู ูู ุชุดุบูู ุณูุฑูุจุช ADD_VIDEO_SECURITY.sql
2. ุชุญูู ูู ุตูุงุญูุงุช RLS ุนูู ุฌุฏูู video_events


